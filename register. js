import { auth, db } from "./firebase-config.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { ref, set } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

window.register = () => {
    const phone = document.getElementById("phone").value.trim();
    const password = document.getElementById("password").value.trim();
    const cpassword = document.getElementById("cpassword").value.trim();
    const refer = document.getElementById("refer").value.trim();

    if (!phone || !password || !cpassword) { alert("সব ঘর পূরণ করুন"); return; }
    if (password !== cpassword) { alert("পাসওয়ার্ড মিলছে না"); return; }

    const email = phone + "@app.com"; // Firebase Auth Email Trick

    createUserWithEmailAndPassword(auth, email, password)
    .then((userCredential) => {
        // Database এ সেভ
        set(ref(db, "users/" + phone), {
            phone: phone,
            balance: 0,
            refCode: refer || "NO-REF",
            joined: new Date().toLocaleString()
        });
        localStorage.setItem("currentUser", phone);
        alert("রেজিস্ট্রেশন সফল!");
        location.href = "home.html";
    })
    .catch((error) => {
        alert("Error: " + error.message);
    });
};
