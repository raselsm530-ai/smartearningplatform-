import { auth, db } from "./firebase-config.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { ref, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

window.registerUser = () => {
    const phone = document.getElementById("phone").value.trim();
    const pass = document.getElementById("password").value.trim();
    const cpass = document.getElementById("cpassword").value.trim();

    if(!phone || !pass || !cpass) {
        alert("‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
        return;
    }
    if(pass !== cpass) {
        alert("‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ");
        return;
    }

    const email = phone + "@smartplatform.com"; // fake email

    createUserWithEmailAndPassword(auth, email, pass)
        .then((userCredential) => {
            const user = userCredential.user;
            set(ref(db, "users/" + phone), {
                phone,
                balance: 0
            });
            localStorage.setItem("loggedInUser", phone);
            alert("‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤ üéâ");
            window.location.href = "home.html";
        })
        .catch(err => {
            if(err.code === "auth/email-already-in-use") {
                alert("‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá");
            } else {
                alert("Error: " + err.message);
            }
        });
}
