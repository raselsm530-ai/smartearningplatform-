import { auth, db } from "./firebase-config.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { ref, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

document.getElementById("registerBtn").addEventListener("click", registerUser);

function registerUser(){
  const phone = document.getElementById("phone").value.trim();
  const pass = document.getElementById("password").value;
  const confirm = document.getElementById("confirm").value;

  if(!phone || !pass || !confirm){
    alert("সব ফিল্ড পূরণ করুন");
    return;
  }

  if(pass !== confirm){
    alert("পাসওয়ার্ড মিলেনি");
    return;
  }

  // ফোনকে ইমেইলে কনভার্ট (Firebase এর জন্য)
  const fakeEmail = phone + "@user.com";

  createUserWithEmailAndPassword(auth, fakeEmail, pass)
    .then(res=>{
      const uid = res.user.uid;

      return set(ref(db,"users/"+uid),{
        phone,
        balance:0,
        created:new Date().toLocaleString()
      });
    })
    .then(()=>{
      alert("✅ Registration Successful");
      window.location.href="login.html";
    })
    .catch(err=>{
      alert(err.message);
    });
}